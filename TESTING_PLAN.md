# 租賃分析系統 - 完整測試計劃

## 📋 目錄
1. [測試環境](#測試環境)
2. [功能測試](#功能測試)
3. [性能測試](#性能測試)
4. [安全性測試](#安全性測試)
5. [外網訪問測試](#外網訪問測試)
6. [數據庫更新測試](#數據庫更新測試)
7. [故障恢復測試](#故障恢復測試)

---

## 測試環境

### 硬件環境
- **NAS 型號**: Synology DS420+
- **CPU**: Intel Celeron
- **內存**: 2GB
- **存儲**: 至少 2GB 可用空間

### 軟件環境
- **系統**: DSM 7.x
- **Container Manager**: 最新版本
- **Python**: 3.11
- **FastAPI**: 最新版本
- **SQLite**: 內置

### 網絡環境
- **內網**: 192.168.x.x 網段
- **外網**: 通過 DDNS 訪問
- **DDNS 提供商**: Synology

---

## 功能測試

### 1. 系統啟動測試

**目的**: 驗證系統能否正常啟動

**測試步驟**:
1. 啟動 Docker 容器
2. 檢查容器日誌
3. 驗證 CSV 自動導入

**預期結果**:
```
✅ 容器已啟動
✅ 看到「CSV 導入完成！」信息
✅ 數據庫已創建
```

**測試記錄**:
- [ ] 容器成功啟動
- [ ] 日誌無錯誤
- [ ] CSV 已導入
- [ ] 數據庫文件已創建

---

### 2. 前端界面測試

**目的**: 驗證前端頁面能否正確加載

**測試步驟**:
1. 訪問 `http://192.168.1.100:8000/index_v6.html`
2. 等待頁面完全加載
3. 檢查所有元素是否正確顯示

**預期結果**:
- ✅ 頁面加載成功
- ✅ Google Maps 地圖顯示
- ✅ 搜尋表單顯示
- ✅ 統計儀表板顯示
- ✅ 熱力圖按鈕顯示

**測試記錄**:
- [ ] 頁面加載成功
- [ ] 地圖顯示正常
- [ ] 表單元素完整
- [ ] 統計儀表板顯示
- [ ] 沒有 JavaScript 錯誤

---

### 3. 地圖顯示測試

**目的**: 驗證房源在地圖上正確顯示

**測試步驟**:
1. 訪問系統首頁
2. 觀察地圖上的房源標記
3. 點擊房源標記查看詳情

**預期結果**:
- ✅ 地圖上顯示多個房源標記（紅色方塊）
- ✅ 標記上顯示房源編號
- ✅ 點擊標記顯示房源詳情
- ✅ 房源分佈合理（集中在中和區）

**測試記錄**:
- [ ] 地圖上有房源標記
- [ ] 標記數量 >= 100
- [ ] 標記位置正確
- [ ] 點擊標記顯示詳情
- [ ] 標記顏色正確（時間梯度）

---

### 4. 搜尋功能測試

**目的**: 驗證搜尋功能能否正常工作

**測試步驟**:
1. 在「地址」欄輸入：`中和區永和路`
2. 設置距離範圍：0-5000 米
3. 點擊「搜尋分析」按鈕
4. 等待結果加載

**預期結果**:
- ✅ 搜尋完成後地圖更新
- ✅ 顯示搜尋圓圈
- ✅ 統計儀表板更新
- ✅ 顯示搜尋結果數量

**測試記錄**:
- [ ] 搜尋成功
- [ ] 地圖更新
- [ ] 圓圈顯示
- [ ] 統計數據更新
- [ ] 結果數量合理

---

### 5. 篩選功能測試

**目的**: 驗證篩選功能能否正常工作

**測試步驟**:
1. 執行搜尋
2. 選擇建築類型：`公寓`
3. 選擇房型：`2房`
4. 點擊「搜尋分析」

**預期結果**:
- ✅ 地圖更新，只顯示符合條件的房源
- ✅ 統計數據更新
- ✅ 結果數量減少

**測試記錄**:
- [ ] 建築類型篩選正常
- [ ] 房型篩選正常
- [ ] 距離篩選正常
- [ ] 多條件組合篩選正常

---

### 6. 統計儀表板測試

**目的**: 驗證統計數據正確顯示

**測試步驟**:
1. 執行搜尋
2. 觀察右側統計儀表板
3. 檢查各項統計數據

**預期結果**:
- ✅ 顯示房源總數
- ✅ 顯示平均租金
- ✅ 顯示房型分布（餅圖）
- ✅ 顯示租金分析（柱狀圖）

**測試記錄**:
- [ ] 房源總數正確
- [ ] 平均租金合理
- [ ] 房型分布正確
- [ ] 租金分析正確
- [ ] 數據更新及時

---

### 7. 熱力圖測試

**目的**: 驗證熱力圖功能能否正常工作

**測試步驟**:
1. 點擊「租金高低」按鈕
2. 觀察地圖顏色變化
3. 點擊「房源密度」按鈕
4. 觀察地圖顏色變化

**預期結果**:
- ✅ 租金高低：紅色表示高租金，綠色表示低租金
- ✅ 房源密度：紅色表示密集，綠色表示稀疏
- ✅ 顏色漸變平滑

**測試記錄**:
- [ ] 租金高低熱力圖正常
- [ ] 房源密度熱力圖正常
- [ ] 顏色區分清晰
- [ ] 切換流暢

---

### 8. 版本控制測試

**目的**: 驗證版本控制功能能否正常工作

**測試步驟**:
1. 查看「版本選擇」下拉菜單
2. 選擇不同版本
3. 點擊「播放」按鈕

**預期結果**:
- ✅ 下拉菜單顯示可用版本
- ✅ 選擇版本後地圖更新
- ✅ 播放按鈕顯示動畫

**測試記錄**:
- [ ] 版本列表正確
- [ ] 版本切換正常
- [ ] 播放動畫流暢
- [ ] 上一週/下一週按鈕正常

---

## 性能測試

### 1. 頁面加載時間

**目的**: 驗證頁面加載速度

**測試步驟**:
1. 打開瀏覽器開發者工具（F12）
2. 進入「Network」標籤
3. 訪問 `http://192.168.1.100:8000/index_v6.html`
4. 記錄加載時間

**預期結果**:
- ✅ 頁面加載時間 < 3 秒
- ✅ 地圖初始化時間 < 5 秒

**測試記錄**:
- [ ] 頁面加載時間: _____ 秒
- [ ] 地圖初始化時間: _____ 秒
- [ ] 是否滿足要求: [ ] 是 [ ] 否

---

### 2. 搜尋響應時間

**目的**: 驗證搜尋功能的響應速度

**測試步驟**:
1. 執行搜尋
2. 記錄從點擊搜尋到結果顯示的時間

**預期結果**:
- ✅ 搜尋響應時間 < 2 秒

**測試記錄**:
- [ ] 搜尋響應時間: _____ 秒
- [ ] 是否滿足要求: [ ] 是 [ ] 否

---

### 3. 數據庫查詢性能

**目的**: 驗證數據庫查詢效率

**測試步驟**:
1. 查看容器日誌
2. 檢查 API 響應時間

**預期結果**:
- ✅ 單次查詢時間 < 500ms

**測試記錄**:
- [ ] 平均查詢時間: _____ ms
- [ ] 最大查詢時間: _____ ms
- [ ] 是否滿足要求: [ ] 是 [ ] 否

---

## 安全性測試

### 1. SQL 注入測試

**目的**: 驗證系統是否容易受到 SQL 注入攻擊

**測試步驟**:
1. 在地址欄輸入：`'; DROP TABLE properties; --`
2. 點擊搜尋
3. 檢查數據庫是否受損

**預期結果**:
- ✅ 系統正常運行
- ✅ 數據庫未受損
- ✅ 顯示「未找到結果」或類似信息

**測試記錄**:
- [ ] SQL 注入測試通過
- [ ] 數據庫完整性檢查: [ ] 通過 [ ] 失敗

---

### 2. XSS 攻擊測試

**目的**: 驗證系統是否容易受到 XSS 攻擊

**測試步驟**:
1. 在地址欄輸入：`<script>alert('XSS')</script>`
2. 點擊搜尋
3. 檢查是否執行了 JavaScript

**預期結果**:
- ✅ 沒有彈出 alert 窗口
- ✅ 腳本被正確轉義

**測試記錄**:
- [ ] XSS 攻擊測試通過

---

### 3. HTTPS 安全性測試

**目的**: 驗證 HTTPS 連接安全

**測試步驟**:
1. 訪問 `https://your-domain.synology.me`
2. 檢查瀏覽器地址欄
3. 查看證書信息

**預期結果**:
- ✅ 顯示「安全」或「鎖定」圖標
- ✅ 使用 HTTPS 協議
- ✅ 證書有效

**測試記錄**:
- [ ] HTTPS 連接成功
- [ ] 證書有效
- [ ] 瀏覽器顯示安全提示

---

## 外網訪問測試

### 1. DDNS 連接測試

**目的**: 驗證 DDNS 能否正常工作

**測試步驟**:
1. 使用手機移動網絡（不連接 WiFi）
2. 訪問 `https://your-domain.synology.me`
3. 檢查是否能訪問系統

**預期結果**:
- ✅ 能成功訪問系統
- ✅ 功能正常

**測試記錄**:
- [ ] 外網訪問成功
- [ ] 功能正常
- [ ] 響應時間: _____ 秒

---

### 2. 不同地區訪問測試

**目的**: 驗證系統在不同地區的可訪問性

**測試步驟**:
1. 在不同地點使用不同網絡訪問
2. 記錄訪問結果

**測試地點**:
- [ ] 公司網絡
- [ ] 其他地點的 WiFi
- [ ] 移動網絡
- [ ] 其他城市（如果可能）

**測試記錄**:
- [ ] 所有地點都能訪問
- [ ] 響應時間合理

---

### 3. 長時間穩定性測試

**目的**: 驗證系統能否長時間穩定運行

**測試步驟**:
1. 連續訪問系統 24 小時
2. 記錄是否有斷線或錯誤

**測試記錄**:
- [ ] 24 小時無斷線
- [ ] 無異常錯誤
- [ ] 數據完整

---

## 數據庫更新測試

### 1. CSV 導入測試

**目的**: 驗證新 CSV 文件能否正確導入

**測試步驟**:
1. 準備新的 CSV 文件
2. 上傳到 `/volume1/docker/rental_uploads/`
3. 重啟容器
4. 檢查是否導入成功

**預期結果**:
- ✅ 容器日誌顯示「CSV 導入完成」
- ✅ 新房源顯示在地圖上
- ✅ 統計數據更新

**測試記錄**:
- [ ] CSV 導入成功
- [ ] 房源數量增加
- [ ] 統計數據正確

---

### 2. 數據去重測試

**目的**: 驗證系統能否正確去重

**測試步驟**:
1. 準備包含重複房源的 CSV 文件
2. 導入系統
3. 檢查房源數量

**預期結果**:
- ✅ 重複房源被正確去重
- ✅ 房源數量正確

**測試記錄**:
- [ ] 去重功能正常
- [ ] 房源數量正確

---

### 3. 數據備份測試

**目的**: 驗證數據備份功能能否正常工作

**測試步驟**:
1. 運行 `database_manager.py`
2. 選擇「備份數據庫」
3. 檢查備份文件

**預期結果**:
- ✅ 備份文件已創建
- ✅ 備份文件大小合理
- ✅ 備份文件可以恢復

**測試記錄**:
- [ ] 備份成功
- [ ] 備份文件完整
- [ ] 恢復測試通過

---

## 故障恢復測試

### 1. 容器崩潰恢復測試

**目的**: 驗證容器崩潰後能否自動恢復

**測試步驟**:
1. 停止容器
2. 等待 30 秒
3. 檢查容器是否自動重啟

**預期結果**:
- ✅ 容器自動重啟
- ✅ 系統恢復正常

**測試記錄**:
- [ ] 容器自動重啟
- [ ] 系統恢復時間: _____ 秒

---

### 2. 數據庫損壞恢復測試

**目的**: 驗證數據庫損壞時的恢復能力

**測試步驟**:
1. 刪除數據庫文件
2. 重啟容器
3. 檢查系統是否能恢復

**預期結果**:
- ✅ 系統自動重新創建數據庫
- ✅ CSV 自動重新導入
- ✅ 系統恢復正常

**測試記錄**:
- [ ] 數據庫自動恢復
- [ ] CSV 自動重新導入
- [ ] 系統恢復時間: _____ 秒

---

### 3. NAS 重啟恢復測試

**目的**: 驗證 NAS 重啟後系統能否正常恢復

**測試步驟**:
1. 重啟 NAS
2. 等待 NAS 完全啟動
3. 檢查系統是否正常運行

**預期結果**:
- ✅ NAS 重啟後容器自動啟動
- ✅ 系統恢復正常
- ✅ 數據完整

**測試記錄**:
- [ ] 容器自動啟動
- [ ] 系統恢復時間: _____ 分鐘
- [ ] 數據完整性: [ ] 完整 [ ] 損壞

---

## 📝 測試總結

### 測試日期: _______________
### 測試人員: _______________
### 測試環境: Synology DS420+ + Container Manager

### 測試結果統計

| 測試類別 | 通過 | 失敗 | 備註 |
|---------|------|------|------|
| 功能測試 | ___ | ___ | |
| 性能測試 | ___ | ___ | |
| 安全性測試 | ___ | ___ | |
| 外網訪問測試 | ___ | ___ | |
| 數據庫更新測試 | ___ | ___ | |
| 故障恢復測試 | ___ | ___ | |

### 總體評分

- [ ] 優秀 (95-100分)
- [ ] 良好 (85-94分)
- [ ] 一般 (70-84分)
- [ ] 需改進 (<70分)

### 發現的問題

1. _______________________________________________
2. _______________________________________________
3. _______________________________________________

### 改進建議

1. _______________________________________________
2. _______________________________________________
3. _______________________________________________

---

**測試完成！** ✅
