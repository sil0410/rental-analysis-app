# CSV 上傳規格說明

## 文件命名格式（四象限分類）

系統採用**四象限分類**架構，CSV 文件需按以下格式命名：

```
{縣市}_{區域}_{建物類型}_{房型大類}_{週次}.csv
```

### 四象限分類

| 建物類型 | 房型大類 | CSV 命名範例 |
|----------|----------|--------------|
| 公寓 | 套房 | `新北市_中和區_公寓_套房_2604.csv` |
| 公寓 | 住家 | `新北市_中和區_公寓_住家_2604.csv` |
| 電梯大樓 | 套房 | `新北市_中和區_電梯大樓_套房_2604.csv` |
| 電梯大樓 | 住家 | `新北市_中和區_電梯大樓_住家_2604.csv` |

### 房型大類說明

- **套房**：只包含套房類型的房源
- **住家**：包含 2房、3房、3房以上等所有非套房類型

---

## CSV 欄位規格

| 欄位名 | 類型 | 必填 | 說明 | 範例 |
|--------|------|------|------|------|
| **案件編號** | 文字 | ✅ | 591 房源唯一 ID | `20377386` |
| **地址** | 文字 | ✅ | 完整地址 | `景平路123號` |
| **租金** | 整數 | ✅ | 月租金（純數字） | `19933` |
| **坪數** | 浮點數 | ✅ | 房源面積 | `16.5` |
| **房型** | 文字 | ✅ | 房間配置（細分） | `2房`、`3房1廳`、`套房` |
| **緯度** | 浮點數 | ✅ | 十進位緯度 | `25.004722` |
| **經度** | 浮點數 | ✅ | 十進位經度 | `121.496389` |
| **週次** | 文字 | ✅ | YYWW 格式 | `2604` |
| **標題** | 文字 | ⬚ | 房源標題 | `近捷運站兩房` |
| **樓層** | 文字 | ⬚ | 樓層資訊 | `4F/5F` |

### 座標格式

系統同時支援兩種座標格式：

1. **十進位格式（推薦）**：獨立的「緯度」和「經度」欄位
   ```
   緯度: 25.004722
   經度: 121.496389
   ```

2. **度分秒格式**：「座標」欄位
   ```
   座標: 25°0'17"N 121°29'47"E
   ```

---

## 週次格式說明

格式：`YYWW`（4位數字）
- `YY`：年份後兩位（如 26 代表 2026 年）
- `WW`：ISO 週數（01-53）

範例：`2604` = 2026 年第 4 週

---

## CSV 範例

### 公寓_套房 CSV
```csv
案件編號,地址,租金,坪數,房型,緯度,經度,週次,標題,樓層
20377386,景平路123號,8500,6.5,套房,25.004722,121.496389,2604,近捷運站套房,4F/5F
20377387,興南路45號,9000,7.0,套房,25.005000,121.497000,2604,景安站旁套房,3F/6F
```

### 公寓_住家 CSV
```csv
案件編號,地址,租金,坪數,房型,緯度,經度,週次,標題,樓層
20458611,福美路6號,26000,30.0,3房,25.005000,121.498333,2604,近大潤發三房,6F/6F
20458612,中和路100號,18000,22.0,2房,25.006000,121.499000,2604,中和站旁兩房,2F/5F
```

---

## 系統載入邏輯

系統會根據使用者的篩選條件，**按需載入**對應的 CSV 文件：

| 使用者選擇 | 載入的 CSV | 說明 |
|------------|------------|------|
| 公寓 + 套房 | 公寓_套房.csv | 1 個文件 |
| 公寓 + 2房 | 公寓_住家.csv | 1 個文件，前端篩選 2房 |
| 電梯 + 全部房型 | 電梯_套房.csv + 電梯_住家.csv | 2 個文件 |
| 全部 + 套房 | 公寓_套房.csv + 電梯_套房.csv | 2 個文件 |
| 全部 + 全部 | 4 個文件 | 最慢，但使用者有預期 |

---

## 舊格式相容

系統也支援舊的 CSV 命名格式：

- `591_中和區_公寓_整層住家_page1.csv`
- `中和公寓套房_2603_merged.csv`

系統會自動從文件名解析建物類型和房型大類。

---

## 上傳流程

1. 將 CSV 文件放入 `upload/` 資料夾
2. 推送到 GitHub
3. Railway 自動部署
4. 系統自動掃描並建立 CSV 索引
5. 使用者查詢時按需載入對應的 CSV
