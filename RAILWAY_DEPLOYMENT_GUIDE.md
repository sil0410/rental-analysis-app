# Railway 部署指南

## 📋 目錄
1. [Railway 簡介](#railway-簡介)
2. [快速部署](#快速部署)
3. [部署後配置](#部署後配置)
4. [數據更新](#數據更新)
5. [故障排除](#故障排除)

---

## Railway 簡介

### 什麼是 Railway？

Railway 是一個現代化的雲端部署平台，類似於 Heroku，但更簡單、更便宜。

**優點：**
- ✅ 完全免費試用（$5/月額度）
- ✅ 無需 Docker 知識
- ✅ 自動 HTTPS
- ✅ 自動部署
- ✅ 支持多種語言和框架

**缺點：**
- ❌ 免費方案無持久化存儲
- ❌ 超過額度需付費
- ❌ 不適合長期生產環境

---

## 快速部署

### 第 1 步：準備 GitHub 倉庫

Railway 需要從 GitHub 部署。您有兩個選擇：

#### 選項 A：使用我為您創建的倉庫（推薦）
- 我會為您上傳所有文件到 GitHub
- 您無需做任何事
- 跳到「第 2 步」

#### 選項 B：自己創建 GitHub 倉庫
1. 訪問 https://github.com/new
2. 創建新倉庫：`rental-analysis-app`
3. 克隆倉庫到本地
4. 上傳以下文件：
   - `main_v4.py`
   - `index_v6.html`
   - `requirements.txt`
   - `Dockerfile.railway`
   - `railway.json`
   - CSV 文件到 `upload/` 文件夾

### 第 2 步：連接 Railway

1. 訪問 https://railway.app
2. 點擊「Login」
3. 選擇「GitHub」登錄（或創建新帳號）
4. 授權 Railway 訪問您的 GitHub

### 第 3 步：創建新項目

1. 點擊「New Project」
2. 選擇「Deploy from GitHub」
3. 選擇倉庫：`rental-analysis-app`
4. 點擊「Deploy」

### 第 4 步：等待部署完成

1. Railway 會自動構建和部署
2. 等待 5-10 分鐘
3. 看到「✓ Deployment successful」表示成功

### 第 5 步：獲取應用 URL

1. 在 Railway 儀表板找到您的應用
2. 點擊「Domains」
3. 複製自動生成的域名，例如：
   ```
   https://rental-app-production.up.railway.app
   ```

---

## 部署後配置

### 第 1 步：訪問應用

在瀏覽器中訪問：
```
https://your-railway-domain/index_v6.html
```

**預期結果：**
- ✅ 看到租賃分析系統界面
- ✅ 地圖上顯示房源標記
- ✅ 統計儀表板顯示數據

### 第 2 步：測試功能

1. **搜尋功能**
   - 在地址欄輸入：`中和區永和路`
   - 點擊「搜尋分析」
   - 確認地圖更新

2. **篩選功能**
   - 選擇建築類型
   - 選擇房型
   - 點擊搜尋

3. **熱力圖**
   - 點擊「租金高低」
   - 點擊「房源密度」

4. **統計數據**
   - 查看房型分布
   - 查看租金分析

### 第 3 步：檢查日誌

在 Railway 儀表板查看日誌：

1. 點擊您的應用
2. 進入「Logs」標籤
3. 查看是否有錯誤

**預期日誌：**
```
📁 找到 X 個 CSV 檔案，開始合併導入...
✅ 已合併 XXX 行數據
✅ 去重後 XXX 行數據
✅ CSV 導入完成！
INFO:     Uvicorn running on http://0.0.0.0:8000
```

---

## 數據更新

### 方式 A：通過 GitHub 更新（推薦）

**步驟：**
1. 在本地更新 CSV 文件
2. 提交到 GitHub
3. Railway 自動重新部署
4. 系統自動導入新數據

**優點：**
- ✅ 自動化
- ✅ 有版本控制
- ✅ 可以回滾

**缺點：**
- ❌ 需要 Git 知識

### 方式 B：通過 Railway 控制台更新

**步驟：**
1. 在 Railway 儀表板進入應用
2. 進入「Variables」標籤
3. 添加環境變量（如需要）
4. 重新部署

**優點：**
- ✅ 無需 Git
- ✅ 立即生效

**缺點：**
- ❌ 不能更新文件
- ❌ 無版本控制

### 方式 C：完整重新部署

**步驟：**
1. 準備新的 CSV 文件
2. 更新 GitHub 倉庫
3. 在 Railway 點擊「Redeploy」
4. 等待部署完成

---

## 故障排除

### 問題 1：部署失敗

**症狀：** Railway 顯示「Deployment failed」

**解決方案：**
1. 查看 Railway 日誌
2. 檢查 `requirements.txt` 是否完整
3. 檢查 `Dockerfile.railway` 是否正確
4. 確保所有文件都已上傳到 GitHub

### 問題 2：應用無法訪問

**症狀：** 訪問 URL 時顯示「502 Bad Gateway」

**解決方案：**
1. 檢查應用是否已啟動
2. 查看 Railway 日誌
3. 等待 5 分鐘（可能還在啟動）
4. 嘗試重新部署

### 問題 3：房源沒有顯示

**症狀：** 地圖上沒有房源標記

**解決方案：**
1. 檢查 CSV 文件是否在 `upload/` 文件夾
2. 查看應用日誌確認 CSV 已導入
3. 執行搜尋（系統可能需要搜尋才能顯示）
4. 檢查瀏覽器控制台是否有 JavaScript 錯誤

### 問題 4：數據丟失

**症狀：** 重新部署後房源消失了

**解決方案：**
1. 這是正常的（Railway 免費方案無持久化存儲）
2. 重新上傳 CSV 文件
3. 重新部署
4. 系統會自動重新導入

---

## 💡 使用建議

### 第 1 週：快速測試
- [ ] 部署到 Railway
- [ ] 測試所有功能
- [ ] 驗證數據完整性

### 第 2-3 週：穩定性測試
- [ ] 定期訪問系統
- [ ] 測試數據更新
- [ ] 記錄性能表現

### 第 4 週：準備遷移
- [ ] 導出最終數據
- [ ] 準備 NAS 環境
- [ ] 計劃遷移時間表

### 長期運行
- [ ] 升級到付費方案（$5-10/月）
- [ ] 或遷移到 NAS
- [ ] 或使用其他平台

---

## 📊 Railway 免費方案限制

| 項目 | 限制 | 說明 |
|------|------|------|
| 月度額度 | $5 USD | 免費試用 |
| 計算資源 | 共享 | 與其他用戶共享 |
| 存儲 | 無持久化 | 重啟後數據丟失 |
| 帶寬 | 無限 | 但受 CPU 限制 |
| 應用數量 | 無限 | 可部署多個應用 |

---

## 🔐 安全建議

### 1. 設置環境變量

在 Railway 儀表板設置敏感信息：
- 數據庫密碼（如需要）
- API 密鑰
- 其他敏感配置

### 2. 啟用 HTTPS

Railway 自動提供 HTTPS，無需額外配置。

### 3. 定期備份

使用以下命令備份數據：
```bash
curl https://your-railway-domain/api/export > backup.json
```

---

## ✅ 部署檢查清單

- [ ] GitHub 帳號已創建
- [ ] 倉庫已創建並上傳所有文件
- [ ] Railway 帳號已創建
- [ ] 應用已連接到 GitHub
- [ ] 部署已完成
- [ ] 應用可以訪問
- [ ] 房源顯示正常
- [ ] 搜尋功能正常
- [ ] 統計數據正確

---

## 📞 需要幫助？

如果遇到問題：

1. **查看 Railway 日誌**
   - Railway 儀表板 → 應用 → Logs

2. **檢查 GitHub 倉庫**
   - 確保所有文件都已上傳
   - 確保文件名正確

3. **重新部署**
   - Railway 儀表板 → 應用 → Redeploy

4. **聯繫支持**
   - Railway 官方文檔：https://docs.railway.app
   - Railway 社區：https://railway.app/community

---

**祝您部署順利！** 🎉
